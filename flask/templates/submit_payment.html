<!DOCTYPE html>
<html>
<head>
    <title>Orness-IbanFirst</title>
        <link rel="stylesheet" href="static/style.css">
        <div class="head-div">
            <h2>Transfert</h2>
        </div>
</head>
    <body>
        
        <div class='container-two'>
            <form method="POST" id="upload" enctype="multipart/form-data">
            <label for="pay_file">Load an Excel table:</label> <br>
            <input type="file" name="file" id="pay_file"> </input>
            <button name="excel" style="width: 60px; height: 25px; background-color: rgb(6, 197, 6);" type="submit">Load</button>
            </form>
            <div id="result">
                {% if result  and typo == "dict" %}
                <p>Le transfert a été effectué avec succès</p>
                {% endif %}
                {% if result == 0 %}
                <p>Le transfert a échoué. Fond insuffisant</p>
                
                {% endif %}
                {% if result == 10 %}
                <p>Le transfert a échoué. Urgence: {{ data['Priorité'] }} n'est pas possible pour compte</p>
                {% endif %}

                {% if payment %}
                
                  
                    <table id="pay">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Sender</th>
                            <th>Recipent</th>
                            <th>Amount</th>
                            
                            <th>Creation Date</th>
                            <th>Commente</th>
                            <th>Execution Date</th>
                            
                            <!-- <th>Action</th> -->
                        </tr>
                        <tbody>
                        {% for pay in payment %}
                        <tr>
                            <td>{{ pay['payment']['id'] }}</td>
                            <td>{{ pay['payment']['sourceWalletId'] }}</td>
                            <td>{{ pay['payment']['externalBankAccountId'] }}</td>
                            <td>{{ pay['payment']['amount']['value'] }}  {{ pay['payment']['amount']['currency'] }}</td>
            
                            <td>{{ pay['payment']['createdDate'] }}</td>
                            <td>{{ pay['payment']['communication'] }}</td>
                            <td>{{ pay['payment']['desiredExecutionDate'] }}</td>
                            
    <!-- 
                            <td><input type="button" value="X" name="delete_payment"><input type="button" style="padding-left: 0; padding-right: 0;" value="&#128394;;" name="validate_pay"></td> -->
                        </tr>
                           

                        {% endfor %}
                        {% else %}
                        {% set flag = 0 %}
                        {% for err in error_pay %}
                            {% if err[0]  == {'SOURCE_ERROR': 0, 'BENEFICIARY_ERROR': 0, 'ERROR_CURRENCY': 0, 'AMOUNT_ERROR': 0} %}
                            
                            <p> {{ err[1] }}: OK</p>
                            {% else %}
                            {% set flag = 1 %}
                            <p> {{ err[1] }}: NOK</p>
                            {% endif %}
                        {% endfor %}
                        {% if flag == 1 %}
                        <p>Errors in the table found. Please check the Currency, Sender or the recipient informations.</p>
                        {% endif %}

                        

                    </tbody> 
                    </thead>
                    </table>

                {% endif %}
                
            
            
            </div>
        <!-- <div  id="wallet_list" class="container">    
             <form method="POST">
            
                <h2> Comptes </h2><br>
                {% if wallets_list %}
                {% for wallet in wallets_list%}
                
                <div  style="color: rgb(128, 128, 131);" class="wallet">
                    <h2>{{ wallet['amountCurrency'] }}</h2>
                    Compte: {{ wallet['holderName'] }}  <br>         
                    IBAN: {{ wallet['holderIBAN'] }}
                    <p style="color: deeppink;">Solde: {{ wallet['amountValue'] }}</p>
                    <input type="checkbox" value={{ wallet['holderIBAN'] }} id="source_Id" name="source_Id" class="single-select" >
                </div>
                {% endfor %}
                {% endif %}
                <script>
                    const checkboxes = document.querySelectorAll('.single-select');
                
                    checkboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', function() {
                            if (this.checked) {
                                checkboxes.forEach(otherCheckbox => {
                                    if (otherCheckbox !== this) {
                                        otherCheckbox.checked = false;
                                    }
                                });
                            }
                        });
                    });
                </script>
                
                <div>
                
                <h2> Bénéficiaire </h2><br>
                
                    <div class="wallet" style="height: 80px;">
                        <input style="width: 90%;" list="holderiban" type="text" autocomplete="on" name="ext_iban" id="ext_iban" ></input> <br><br>
                        <datalist id="holderiban" style="color: rgb(105, 105, 102);" class="external_iban" ></select>
                        {% if extern %}
                        {% for ext in extern %}
                        
                            <option id="recipient" id="choice_ext_iban" name="choice_ext_iban" value="{{ ext['holderIBAN'] }}"> <p>Compte: {{ ext['holderName'] }} > IBAN: {{ ext['holderIBAN'] }}</p></option>
                        
                        {% endfor %}
                        {% endif %}
                        </datalist>
                        <a href="/create_exteral_bank_account" style="color: black; border-bottom: 1px solid black; background-color: rgb(16, 214, 214);">Créer un bénéficiaire</a>
                    </div>
                    
                </div>
        
        
            
            <label for="amount">Montant :</label>
            <input type="number" id="amount" name="amount" required><br><br>
        
            <label for="tag"> Libélé      :</label>
            <input type="text" id="tag" name="tag"><br><br>
            
            <label for="date">Date désirée :</label>
            <input type="date" id="date" name="date" ><br><br>
            <label for="urgency">Urgence :</label>
            <select id="urgency" name="urgency">
                <option value="Urgent">Urgent</option>
                <option value="Normal">Normal</option>
                <option value="Différé">Différé</option>
            </select><br><br>
            <label for="fees">Transaction à la charge de</label>
            <select id="who_pay_fees" name="who_pay_fees">
                <option value="OUR">Client</option>
                <option value="SHARE">Partagé</option>
                <option value="BEN">Bénéficiaire</option>
            </select>
            
            <label for="comment">Commentaire :</label><br>
            <textarea id="comment" name="comment" rows="4" cols="50"></textarea><br><br>

            <div class="container-child">
                  
                <button style="width: 250px; height: 25px; background-color: rgb(6, 197, 6);" type="submit" >Envoyer</button>
            </div>
            

        
            </form> 
            </div> -->

        </div>
        <div class="container-two" >
            <caption> History of transactions </caption> 
            <div class="table" >   
            <table id="histo">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Sender</th>
                    <th>Recipient</th>
                    <th>Amount</th>
                    <th>Rate</th>
                    <th>Creation Date</th>
                    <th>Comment</th>
                    <th>Counter Value</th>
                    <th>Status</th>
                    
                    <!-- <th>Action</th> -->
                </tr>
                <tbody>
                {% if history %}
                {% for hist in history %}
                <tr>
                    <td>{{ hist['id'] }}</td>
                    <td>{{ hist['sourceWalletId'] }}</td>
                    <td>{{ hist['externalBankAccountId'] }}</td>
                    <td>{{ hist['amount']['value'] }}  {{ hist['amount']['currency'] }}</td>
                    <td>{{ hist['rate']['appliedBid'] }}  {{ hist['rate']['currencyPair'] }}</td>
                    <td>{{ hist['createdDate'] }}</td>
                    <td>{{ hist['communication'] }}</td>
                    <td>{{ hist['counterValue']['value'] }}  {{ hist['counterValue']['currency'] }}</td>
                    <td>{{ hist['status'] }}</td>
<!-- 
                    <td><input type="button" value="X" name="delete_payment"><input type="button" style="padding-left: 0; padding-right: 0;" value="&#128394;;" name="validate_pay"></td> -->
                </tr>
                {% endfor %}
                {% endif %}
                {% if plan %}
                   {% for  planif in plan %}
                <tr>
                    <td>{{ planif['id'] }}</td>
                    <td>{{ planif['sourceWalletId'] }}</td>
                    <td>{{ planif['externalBankAccountId'] }}</td>
                    <td>{{ planif['amount']['value'] }}  {{ planif['amount']['currency'] }}</td>
                    <td>{{ planif['rate']['appliedBid'] }}  {{ planif['rate']['currencyPair'] }}</td>
                    <td>{{ planif['createdDate'] }}</td>
                    <td>{{ planif['communication'] }}</td>
                    <td>{{ planif['counterValue']['value'] }}  {{ planif['counterValue']['currency'] }}</td>
                    <td>{{ planif['status'] }}</td>
                    <!-- <td><input type="button" value="X" name="delete_payment"> <input type="button" style="padding-left: 0; padding-right: 0;" value="&#128394;;" name="Edit"></td> -->
                </tr>
                {% endfor %}
                {% endif %}
                </tbody>
                </thead>
            </table>
            </div>
        </div>
        
        
        

    </body>
</html>